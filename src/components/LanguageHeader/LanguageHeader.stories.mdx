import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import { InputLabel, TextField, Textarea } from '@acpaas-ui/react-components';
import { Formik, Field } from 'formik';
import { useState, useEffect } from 'react';
import { LANGUAGE_HEADER_MOCK_LANGUAGES, LANGUAGE_HEADER_MOCK_TOOLTIP, INITIAL_VALUES_MOCK} from './LanguageHeader.mock';
import LanguageHeader from './LanguageHeader';
import MultilanguageField from '../MultilanguageField/MultilanguageField';

<Meta title="LanguageHeader" component={LanguageHeader} />

# Language Header

The language header can be used as a language selector on top of a form.

## Preview of component

<Preview>
	<Story name='Base'>
		{() => {
			const languages = LANGUAGE_HEADER_MOCK_LANGUAGES;
			const [activeLanguage, setActiveLanguage] = useState(null);
			// setup preselected language
			useEffect(() => {
				if (Array.isArray(languages)) {
					console.log(languages.find(l => l.primary));
					setActiveLanguage(languages.find(l => l.primary) || languages[0]);
				}
			}, []);
			const onSave = (newValue) => {
				console.log(newValue);
			};
			const onChange = (newValue) => {
				console.log('change', newValue);
			};
			const handleChangeLanguage = (lang) => {
				setActiveLanguage({key: lang})
			};
			return (
				<LanguageHeader
					className="u-margin"
					languages={languages}
					activeLanguage={activeLanguage}
					tooltipText={LANGUAGE_HEADER_MOCK_TOOLTIP}
					onChangeLanguage={handleChangeLanguage}>
					{activeLanguage &&
						<div className="u-margin-top">
							<p>Formik form placeholder</p>
							<p>Selected language: <b>{activeLanguage.key}</b></p>
						</div>
					}
				</LanguageHeader>
			)
		}}
	</Story>
</Preview>

## In action

<Preview>
	<Story name='In action'>
		{() => {
			const languages = LANGUAGE_HEADER_MOCK_LANGUAGES;
			const [activeLanguage, setActiveLanguage] = useState(null);
			const [formValues, setFormValues] = useState();
			// setup preselected language
			useEffect(() => {
				if (Array.isArray(languages)) {
					console.log(languages.find(l => l.primary));
					setActiveLanguage(languages.find(l => l.primary) || languages[0]);
				}
			}, []);
			const onChange = (newValue) => {
				setFormValues(newValue);
			};
			const handleChangeLanguage = (lang) => {
				setActiveLanguage({key: lang})
			};
			return (
				<>
					<LanguageHeader
						className="u-margin"
						languages={languages}
						activeLanguage={activeLanguage}
						tooltipText={LANGUAGE_HEADER_MOCK_TOOLTIP}
						onChangeLanguage={handleChangeLanguage}>
						<div className="u-margin-top">
							<Formik
								onSubmit={console.log}
								initialValues={INITIAL_VALUES_MOCK}>
								{({ errors, submitForm, values, resetForm, setFieldValue }) => {
									onChange(values);
									return (
										<div>
											<div className="row u-margin-bottom">
												<div className="col-xs-12">
													<Field as={TextField} label="Titel" name="title"/>
												</div>
											</div>
											<div className="row u-margin-bottom">
												<div className="col-xs-12">
													<MultilanguageField
														as={Textarea}
														label="Omschrijving"
														name="description"
														value={values.description}
														setFieldValue={setFieldValue}
														languages={languages}
														activeLanguage={activeLanguage}/>
												</div>
											</div>
										</div>
									)
								}}
							</Formik>
						</div>
					</LanguageHeader>
					<p><b>Form values:</b></p>
					<p>{JSON.stringify(formValues)}</p>
				</>
			)
		}}
	</Story>
</Preview>

## Props

<Props of={LanguageHeader} />
